<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<head>
  <title></title>
	    
  <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
	integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
	  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
	  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
	  crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.12.0/paper-full.min.js"></script>
  
  <script src="./three.min.js"></script>  
  
  <script src="https://code.jquery.com/pep/0.4.1/pep.js"></script>  
  <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>
    
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paste.js/0.0.21/paste.min.js"></script>
  
  <script src="./libs.build.js"></script>
  <script src="./app.draw.js"></script>
  <script src="./app.fitting.js"></script>
  <script src="./app.export.js"></script>
  <script src="./app.js"></script>
  <script src="./app.lights.js"></script>
  <link href="https://fonts.googleapis.com/css?family=B612" rel="stylesheet">
  <style>
    body { font-family: 'B612', sans-serif; }
    #canvas { border: thin solid grey }
    #sidemenu img { display: block; width: 40; height: 40; padding: 4 }
    #sidemenu img { display: block; width: 36; height: 36; padding: 4 }
  </style>
</head>

<body>
  <div id="topmenu">
  </div>
  <div class="container-fluid" style="padding-top:70px">
    <div class="row" >
      <div class="col-12">
	<div style="height:80vh;width:4vw;display:inline-block" id="sidemenu">
	  <img data-command="freehand" src="./icons/draw-freehand.svg">
	  <img data-command="splines" src="./icons/draw-splines.svg">
	  <img data-command="straight lines" src="./icons/draw-polylines.svg">	
	  <img data-command="zoom to fit" src="./icons/zoom-fit-selection.svg">
	</div>
	<div style="height:80vh;width:76vw;position:relative;display:inline-block">
	  <div class="" id="webGL" style="width:100%;height:80vh;position: absolute; padding:0;margin:0">
	  </div>
	  <div class="" id="canvas" style="width:100%;height:80vh;position: absolute; padding:0;margin:0">
	  </div>
	  <canvas id="paper" style="width:100%;height:80vh;position: absolute; padding:0;margin:0;display:none">
	  </canvas>
	</div>
	<div id="cards" style="font-size:80%;height:80vh;width:17vw;position:absolute;top:0;display:inline-block;margin-left:6px">
	</div>
      </div>
    </div>
    <div class="row">
      <div class="col-2 offset-1"><pre id="bbox_min">bbox</pre></div>
      <div class="col-2"><pre id="bbox_max">bbox</pre></div>
      <div class="col-2"><pre id="bbox_center">bbox</pre></div>
    </div>
  </div>
  <script>
    var app;
    function animate() { requestAnimationFrame( animate ); app.controls.update(); app.render() }
    $(function(){
	// var c = new OffscreenCanvas(100, 100);
	// console.log(c);
	var canvas = document.getElementById('paper');
	// paper.setup(canvas);
	// var path = new paper.Path(pathData);
	// path.simplify()
	// console.log(path.exportSVG().outerHTML);
	app = new App(document.getElementById('webGL'), document.getElementById('canvas') );

	app.db.objects.get('test')
	    .then(e => {
		console.log('object loaded from database')
		app.load(e.obj, app.defaultMaterial);
	    });
	
	var frustumSize = 1000;
	// app.scene.background = new THREE.Color( 0xddeeff );
	
	app.camera = new THREE.OrthographicCamera(
	    frustumSize * app.$3D.aspect / - 2,
	    frustumSize * app.$3D.aspect / 2,
	    frustumSize / 2,
	    frustumSize / - 2,
	    -32000,
	     32000
	);

	app.camera.position.set( 100, 100, 100 );
	app.scene.add(app.camera);

	app.scene.background = new THREE.Color( 0xdddddd );

	app.controls = new THREE.OrbitControls( app.camera, document.getElementById('canvas') );

	app.addShadowedLight( 1,   1,  1, 0xffffff, 1 );
	app.addShadowedLight( -1,  1, -1, 0xffffff, 1 );
	app.addShadowedLight( 0,  -1, -1, 0xffffff, 1 );

	var geometry = new THREE.SphereGeometry( 5, 32, 32 );
	var axesHelper = new THREE.AxesHelper( 25 );


	app.scene.add(axesHelper);

	
	app.animate()
    })
  </script>
  <script src="./ui.js"></script>
</body>
</html>
